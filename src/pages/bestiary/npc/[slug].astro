---
import BaseLayout from "../../../layouts/BaseLayout.astro";

import TagsList from "../../../components/TagsList.astro";

import "../../../styles/creature.css";

import { getCollection, getEntry } from "astro:content";
import { slugFromId } from "../../../utils/slug";

export async function getStaticPaths() {
  const npcs = await getCollection("npc");

  return npcs.map((entry) => ({
    params: { slug: slugFromId(entry.id) },
    props: { id: entry.id },
  }));
}

const { id } = Astro.props;
const npc = await getEntry("npc", id);

// Shorthand
const statblock = npc.data;

const page = {
  title: "Bestiary",
  path: "/bestiary",
  metaTitle: `${statblock.name} | Bestiary`,
}
---

<BaseLayout page={page}>
  <h3><strong>NPC</strong></h3>
  <h2 class="db-green-dark">{statblock.name}</h2>
  <hr>
  <TagsList tags={statblock.tags} />
  <br/>

  <div class="page-columns">

    {statblock.description && (
      <div class="db-font-normal mb-4">
        {statblock.description}
      </div>
    )}

    <div class="stats-box | mb-5 mb-lg-4">
      <table class="stats-table | db-font-normal">
        <tr>
          <td>
            <label>Morale:</label>
            <span class="d-inline-block">{statblock.morale ?? "—"}</span>
          </td>

          <td colspan="2">
            <label>D. Bonus:</label>
            <span class="d-inline-block">
              {
                statblock.damage_bonuses && statblock.damage_bonuses.length > 0
                  ? statblock.damage_bonuses.map(db => `${db.type}+${db.value}`).join(", ")
                  : "—"
              }
            </span>
          </td>
        </tr>

        <tr>
          <td>
            <label>Move:</label>
            <span class="d-inline-block">{statblock.move}</span>
          </td>

          <td colspan="2">
            <label>HP:</label>
            <span class="d-inline-block">{statblock.hp}</span>

            <term class="ms-2">WP:</label>
            <span class="d-inline-block">{statblock.wp ?? "—"}</span>
          </td>
        </tr>

        {statblock.skills && statblock.skills.length > 0 && (
          <tr>
            <td colspan="3">
              <term class="me-1">Skills:</label>
              {statblock.skills.map((skill, i) => (
                <span class="d-inline-block capitalized">
                  {skill.name} {skill.level}{i < statblock.skills.length - 1 ? ", " : ""}
                </span>
              ))}
            </td>
          </tr>
        )}

        {statblock.abilities && statblock.abilities.length > 0 && (
          <tr>
            <td colspan="3">
              <term class="me-1">Abilities:</label>
              {statblock.abilities.map((ability, i) => (
                <span class="d-inline-block capitalized">
                  {ability}{i < statblock.abilities.length - 1 ? ", " : ""}
                </span>
              ))}
            </td>
          </tr>
        )}

        {statblock.spells && statblock.spells.length > 0 && (
          <tr>
            <td colspan="3">
              <term class="me-1">Spells:</label>
              {statblock.spells.map((spell, i) => (
                <span class="d-inline-block">
                  {spell}{i < statblock.spells.length - 1 ? ", " : ""}
                </span>
              ))}
            </td>
          </tr>
        )}

        {statblock.armors && statblock.armors.length > 0 && (
          <tr>
            <td colspan="3">
              <term class="me-1">Typical Armor:</label>
              {statblock.armors.map((armor, i) => (
                <span class="d-inline-block capitalized">
                  {armor.name} ({armor.rating}){i < statblock.armors.length - 1 ? ", " : ""}
                </span>
              ))}
            </td>
          </tr>
        )}

        {statblock.weapons && statblock.weapons.length > 0 && (
          <tr>
            <td colspan="3">
              <term class="me-1">Typical Weapons:</label>
              {statblock.weapons.map((weapon, i) => (
                <span class="d-inline-block capitalized">
                  {weapon.name} ({weapon.damage_dice.count}{weapon.damage_dice.type}){i < statblock.weapons.length - 1 ? ", " : ""}
                </span>
              ))}
            </td>
          </tr>
        )}
      </table>

      {statblock.resistance && (
        <div class="mt-1">
          <p>
            <b>Resistance:</b> {statblock.resistance}
          </p>
        </div>
      )}

      {statblock.immunity && (
        <div>
          <p>
            <b>Immunity:</b> {statblock.immunity}
          </p>
        </div>
      )}

      {statblock.weakness && (
        <div>
          <p>
            <b>Weakness:</b> {statblock.weakness}
          </p>
        </div>
      )}

      {statblock.effects && (
        <div>
          {statblock.effects.map((e) => (
            <p>
              <b>{e.name}:</b> {e.description}
            </p>
          ))}
        </div>
      )}

    </div>
  </div>
</BaseLayout>
